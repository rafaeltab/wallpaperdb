---
title: Troubleshooting
description: Common issues and solutions when working with the TesterBuilder pattern and Testcontainers.
---

Common issues and solutions when working with the TesterBuilder pattern and Testcontainers.

## Container Startup Issues

### "Could not find a working container runtime strategy"

**Symptoms:**
```
Error: Could not find a working container runtime strategy
```

**Cause:** Docker is not running or not accessible

**Solutions:**

1. Start Docker Desktop (Mac/Windows) or Docker daemon (Linux)
   ```bash
   # Linux
   sudo systemctl start docker
   ```

2. Verify Docker is running
   ```bash
   docker ps
   ```

3. Check Docker permissions (Linux)
   ```bash
   sudo usermod -aG docker $USER
   # Log out and back in
   ```

### "Port already in use"

**Symptoms:**
```
Error: bind: address already in use
```

**Solutions:**

1. Use unique database names (generates random ports)
   ```typescript
   tester.withPostgres((b) =>
     b.withDatabase(`test_${Date.now()}`)
   );
   ```

2. Stop conflicting containers
   ```bash
   docker ps
   docker stop <container-id>
   ```

### "Container failed to start within timeout"

**Solutions:**

1. Increase test timeout
   ```typescript
   beforeAll(async () => {
     // ... setup
   }, 120000);  // Increase to 120 seconds
   ```

2. Check container logs
   ```bash
   docker logs <container-id>
   ```

3. Verify image is pulled
   ```bash
   docker pull postgres:16-alpine
   ```

## Type Errors

### "Property 'withX' does not exist"

**Cause:** Builder not added to composition

**Solution:**
```typescript
// Missing PostgresTesterBuilder
createTesterBuilder()
  .with(MinioTesterBuilder)
  .build();

// Add PostgresTesterBuilder
createTesterBuilder()
  .with(PostgresTesterBuilder)  // Add this
  .with(MinioTesterBuilder)
  .build();
```

### "Type 'X' is not assignable to type 'Y'"

**Cause:** Required dependency not added

**Solution:**
```typescript
// PostgresTesterBuilder needs DockerTesterBuilder
createTesterBuilder()
  .with(DockerTesterBuilder)  // Add this first
  .with(PostgresTesterBuilder)
  .build();
```

## Connection Errors

### "ECONNREFUSED" in Integration Tests

**Cause:** Using Docker network for in-process tests

**Solution:** Don't create Docker network for integration tests

### "getaddrinfo ENOTFOUND postgres"

**Cause:** Missing Docker network for E2E tests

**Solution:** Use `host.docker.internal` for container-to-container communication

### "Connection terminated unexpectedly"

**Solutions:**

1. Check container logs
   ```bash
   docker logs <container-id>
   ```

2. Verify container is running
   ```bash
   docker ps -a
   ```

3. Check for resource limits
   ```bash
   docker stats
   ```

## Test Execution Issues

### Tests Hang Indefinitely

**Solutions:**

1. Forgot to call `setup()`
   ```typescript
   beforeAll(async () => {
     await tester.setup();  // Add this
   });
   ```

2. Forgot to call `destroy()`
   ```typescript
   afterAll(async () => {
     await tester.destroy();  // Add this
   });
   ```

### "App not initialized"

**Cause:** Accessing resources before `setup()`

**Solution:**
```typescript
beforeAll(async () => {
  await tester.setup();  // Must call this first
});

it("test", async () => {
  const app = tester.getApp();  // Now works
});
```

### Slow Test Execution

**Solutions:**

1. Use integration tests instead of E2E (2-5s vs 10-30s)

2. Reuse containers across tests
   ```typescript
   // Good - one setup for all tests
   beforeAll(async () => {
     await tester.setup();
   });
   ```

3. Run integration tests in parallel
   ```typescript
   // vitest.config.ts
   export default {
     test: { maxConcurrency: 5 },
   };
   ```

4. Cache Docker images
   ```bash
   docker pull postgres:16-alpine
   docker pull minio/minio:latest
   docker pull nats:2.10-alpine
   ```

## Memory Issues

### "Docker out of memory"

**Solutions:**

1. Increase Docker memory limit (Docker Desktop Settings → Resources → Memory)

2. Clean up old containers
   ```bash
   docker system prune -a
   ```

3. Limit concurrent tests
   ```typescript
   // vitest.config.ts
   export default {
     test: { maxConcurrency: 3 },
   };
   ```

## Platform-Specific Issues

### Linux: Permission Denied

```bash
sudo usermod -aG docker $USER
# Log out and back in
```

### macOS: DNS Resolution Slow

Tests slow due to "localhost" resolution - builders automatically use `127.0.0.1`.

### Windows: Path Issues

Use `path.join()` for cross-platform paths:
```typescript
import { join } from "node:path";
const migrationPath = join(__dirname, "../../migrations.sql");
```

## Getting Help

1. Check existing tests for examples
2. Review documentation
3. Check container logs: `docker logs <container-id>`
4. Enable debug logging: `process.env.DEBUG = "testcontainers*"`
